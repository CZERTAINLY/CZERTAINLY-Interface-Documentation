openapi: 3.0.1
info:
  title: CZERTAINLY Client API
  description: REST API for managing Clients in the platform
  contact:
    name: CZERTAINLY
    url: https://www.czertainly.com
    email: getinfo@czertainly.com
  license:
    name: MIT License
    url: https://github.com/3KeyCompany/CZERTAINLY/blob/develop/LICENSE.md
  x-logo:
    url: images/czertainly_color_H.svg
externalDocs:
  description: CZERTAINLY Documentation
  url: https://docs.czertainly.com
servers:
- url: http://localhost:8080
  description: Generated server url
tags:
- name: Client Management API
  description: Client Management API
paths:
  /v1/clients/{uuid}/unauthorize/{raProfileUuid}:
    put:
      tags:
      - Client Management API
      summary: Unauthorize Client
      operationId: unauthorizeClient
      parameters:
      - name: uuid
        in: path
        required: true
        schema:
          type: string
      - name: raProfileUuid
        in: path
        required: true
        schema:
          type: string
      responses:
        "200":
          description: Client unauthorized with given profile
        "404":
          description: Not found
        "400":
          description: Invalid request
  /v1/clients/{uuid}/enable:
    put:
      tags:
      - Client Management API
      summary: Enable a client
      operationId: enableClient
      parameters:
      - name: uuid
        in: path
        required: true
        schema:
          type: string
      responses:
        "200":
          description: Client enabled
        "404":
          description: Not found
        "400":
          description: Invalid request
  /v1/clients/{uuid}/disable:
    put:
      tags:
      - Client Management API
      summary: Disable a client
      operationId: disableClient
      parameters:
      - name: uuid
        in: path
        required: true
        schema:
          type: string
      responses:
        "200":
          description: Client disabled
        "404":
          description: Not found
        "400":
          description: Invalid request
  /v1/clients/{uuid}/authorize/{raProfileUuid}:
    put:
      tags:
      - Client Management API
      summary: Authorize a client
      operationId: authorizeClient
      parameters:
      - name: uuid
        in: path
        required: true
        schema:
          type: string
      - name: raProfileUuid
        in: path
        required: true
        schema:
          type: string
      responses:
        "200":
          description: Client authorized with given profile
        "404":
          description: Not found
        "400":
          description: Invalid request
  /v1/clients/enable:
    put:
      tags:
      - Client Management API
      summary: Enable multiple client
      operationId: bulkEnableClient
      requestBody:
        content:
          application/json:
            schema:
              type: array
              items:
                type: string
        required: true
      responses:
        "204":
          description: Client enabled
        "404":
          description: Not found
        "400":
          description: Invalid request
  /v1/clients/disable:
    put:
      tags:
      - Client Management API
      summary: Disable multiple client
      operationId: bulkDisableClient
      requestBody:
        content:
          application/json:
            schema:
              type: array
              items:
                type: string
        required: true
      responses:
        "404":
          description: Not found
        "400":
          description: Invalid request
        "204":
          description: Client disabled
  /v1/clients/{uuid}:
    get:
      tags:
      - Client Management API
      summary: Get the details of a client
      operationId: getClient
      parameters:
      - name: uuid
        in: path
        required: true
        schema:
          type: string
      responses:
        "404":
          description: Not found
        "400":
          description: Invalid request
        "200":
          description: Client details retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClientDto'
    post:
      tags:
      - Client Management API
      summary: Edit a client
      operationId: editClient
      parameters:
      - name: uuid
        in: path
        required: true
        schema:
          type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EditClientRequestDto'
        required: true
      responses:
        "200":
          description: Client edited
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClientDto'
        "404":
          description: Not found
        "400":
          description: Invalid request
    delete:
      tags:
      - Client Management API
      summary: Remove a client
      operationId: removeClient
      parameters:
      - name: uuid
        in: path
        required: true
        schema:
          type: string
      responses:
        "200":
          description: Client Deleted
        "404":
          description: Not found
        "400":
          description: Invalid request
  /v1/clients:
    get:
      tags:
      - Client Management API
      summary: Get the list of all clients
      operationId: listClients
      responses:
        "200":
          description: Client list retrieved
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ClientDto'
        "404":
          description: Not found
        "400":
          description: Invalid request
    post:
      tags:
      - Client Management API
      summary: Add a new client
      operationId: addClient
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddClientRequestDto'
        required: true
      responses:
        "200":
          description: New client added
          content:
            application/json:
              schema:
                type: object
        "404":
          description: Not found
        "400":
          description: Invalid request
    delete:
      tags:
      - Client Management API
      summary: Remove multiple client
      operationId: bulkRemoveClient
      requestBody:
        content:
          application/json:
            schema:
              type: array
              items:
                type: string
        required: true
      responses:
        "200":
          description: Clients Deleted
        "404":
          description: Not found
        "400":
          description: Invalid request
  /v1/clients/{uuid}/listauth:
    get:
      tags:
      - Client Management API
      summary: Get Authorized profiles
      operationId: listAuthorizations
      parameters:
      - name: uuid
        in: path
        required: true
        schema:
          type: string
      responses:
        "404":
          description: Not found
        "200":
          description: List of authorized profiles
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/RaProfileDto'
        "400":
          description: Invalid request
components:
  schemas:
    EditClientRequestDto:
      type: object
      properties:
        description:
          type: string
          description: Description of the client
        clientCertificate:
          type: string
          description: Base64 content of the certificate
        certificateUuid:
          type: string
          description: UUID of the existing certificate in inventory
    AttributeCallback:
      required:
      - callbackContext
      - callbackMethod
      - mappings
      type: object
      properties:
        callbackContext:
          type: string
          description: Context part of callback URL
        callbackMethod:
          type: string
          description: HTTP method of the callback
        mappings:
          uniqueItems: true
          type: array
          description: Mappings for the callback method
          items:
            $ref: '#/components/schemas/AttributeCallbackMapping'
        pathVariables:
          type: object
          additionalProperties:
            type: object
            description: Map of path variables supported by the callback method
          description: Map of path variables supported by the callback method
        queryParameters:
          type: object
          additionalProperties:
            type: object
            description: Map of the query parameters supported by the callback method
          description: Map of the query parameters supported by the callback method
        requestBody:
          type: object
          additionalProperties:
            type: object
            description: Request body for the callback method
          description: Request body for the callback method
      description: Optional definition of callback for helper methods
    AttributeCallbackMapping:
      required:
      - targets
      - to
      type: object
      properties:
        from:
          type: string
          description: Name of the attribute whose value is to be used as value of
            path variable or request param or body field.It is optional and must be
            set only if value is not set.
        attributeType:
          type: string
          description: Type of the attribute. It is optional and must be set only
            if special behaviour is needed.
          enum:
          - STRING
          - SECRET
          - FILE
          - BOOLEAN
          - LIST
          - CREDENTIAL
        to:
          type: string
          description: Name of the path variable or request param or body field which
            is to be used to assign value of attribute
        targets:
          uniqueItems: true
          type: array
          description: Set of targets for propagating value.
          items:
            type: string
            description: Set of targets for propagating value.
            enum:
            - PATH_VARIABLE
            - REQUEST_PARAMETER
            - BODY
        value:
          type: object
          description: Static value to be propagated to targets. It is optional and
            is set only if the value is known at attribute creation time.
      description: Mappings for the callback method
    AttributeDefinition:
      required:
      - editable
      - label
      - multiValue
      - name
      - readOnly
      - required
      - type
      - uuid
      - visible
      type: object
      properties:
        uuid:
          type: string
          description: UUID of the Attribute
          example: 166b5cf52-63f2-11ec-90d6-0242ac120003
        name:
          type: string
          description: Name of the Attribute
          example: Attribute
        label:
          type: string
          description: Label of the the Attribute
          example: Attribute Name
        type:
          type: string
          description: Type of the Attribute
          enum:
          - STRING
          - SECRET
          - FILE
          - BOOLEAN
          - LIST
          - CREDENTIAL
        required:
          type: boolean
          description: Boolean determining if the Attribute is required
          default: false
        readOnly:
          type: boolean
          description: Boolean determining if the Attribute is read only
          default: false
        editable:
          type: boolean
          description: Boolean determining if the Attribute is editable
          default: true
        visible:
          type: boolean
          description: Boolean determining if the Attribute is visible and can be
            displayed
          default: true
        multiValue:
          type: boolean
          description: Boolean determining if the Attribute has value composed from
            multiple items
          default: false
        description:
          type: string
          description: "Optional description of the Attribute, should contain help\
            \ for setting proper value"
        validationRegex:
          type: string
          description: Optional regular expression used for validating the Attribute
            value
        dependsOn:
          type: array
          description: Optional list of other Attribute names and values on which
            it depends on
          items:
            $ref: '#/components/schemas/AttributeDependency'
        attributeCallback:
          $ref: '#/components/schemas/AttributeCallback'
        value:
          type: object
          description: Value of the Attribute
      description: List of RA Profiles attributes
    AttributeDependency:
      required:
      - name
      - value
      type: object
      properties:
        name:
          type: string
          description: Name of depending attribute
        value:
          type: object
          description: "Value of depending attribute, which should be matched"
      description: Optional list of other Attribute names and values on which it depends
        on
    CertificateDto:
      required:
      - basicConstraints
      - certificateContent
      - commonName
      - fingerprint
      - issuerCommonName
      - issuerDn
      - keySize
      - keyUsage
      - notAfter
      - notBefore
      - publicKeyAlgorithm
      - serialNumber
      - signatureAlgorithm
      - status
      - subjectDn
      - uuid
      type: object
      properties:
        uuid:
          type: string
          description: UUID of the Certificate
        commonName:
          type: string
          description: Certificate common name
        serialNumber:
          type: string
          description: Certificate serial number
        issuerCommonName:
          type: string
          description: Certificate issuer common name
        certificateContent:
          type: string
          description: Base64 encoded Certificate content
        issuerDn:
          type: string
          description: Issuer DN of the Certificate
        subjectDn:
          type: string
          description: Subject DN of the Certificate
        notBefore:
          type: string
          description: Certificate validity start date
          format: date-time
        notAfter:
          type: string
          description: Certificate expiration date
          format: date-time
        publicKeyAlgorithm:
          type: string
          description: Public key algorithm
        signatureAlgorithm:
          type: string
          description: Certificate signature algorithm
        keySize:
          type: integer
          description: Certificate key size
          format: int32
        extendedKeyUsage:
          type: array
          description: Extended key usages
          items:
            type: string
            description: Extended key usages
        keyUsage:
          type: array
          description: Key usages
          items:
            type: string
            description: Key usages
        basicConstraints:
          type: string
          description: Basic Constraints
        meta:
          type: object
          additionalProperties:
            type: object
            description: Certificate meta data
          description: Certificate meta data
        status:
          type: string
          description: Status of the Certificate
          enum:
          - VALID
          - REVOKED
          - EXPIRED
          - UNKNOWN
          - EXPIRING
          - NEW
          - INVALID
        raProfile:
          $ref: '#/components/schemas/RaProfileDto'
        fingerprint:
          type: string
          description: SHA256 fingerprint of the Certificate
        subjectAlternativeNames:
          type: object
          additionalProperties:
            type: object
            description: Subject alternative names
          description: Subject alternative names
        entity:
          $ref: '#/components/schemas/CertificateEntityDto'
        group:
          $ref: '#/components/schemas/CertificateGroupDto'
        owner:
          type: string
          description: Certificate Owner
        certificateType:
          type: string
          description: Certificate type
          enum:
          - X509
          - SSH
        issuerSerialNumber:
          type: string
          description: Serial number of the issuer
        certificateValidationResult:
          type: object
          additionalProperties:
            $ref: '#/components/schemas/CertificateValidationDto'
          description: Certificate validation result
      description: Client Certificate Information
    CertificateEntityDto:
      required:
      - entityType
      - name
      - uuid
      type: object
      properties:
        uuid:
          type: string
          description: Object identifier
        name:
          type: string
          description: Object Name
        description:
          type: string
          description: Description of the Entity
        entityType:
          type: string
          description: Type of the Entity
          enum:
          - SERVER
          - ROUTER
          - HSM
          - SWITCH
          - LOAD_BALANCER
          - FIREWALL
          - MDM
          - CLOUD
      description: Entity associated to the Certificate
    CertificateGroupDto:
      required:
      - name
      - uuid
      type: object
      properties:
        uuid:
          type: string
          description: Object identifier
        name:
          type: string
          description: Object Name
        description:
          type: string
          description: Description of the Certificate Group
      description: Group associated to the Certificate
    CertificateValidationDto:
      type: object
      properties:
        status:
          type: string
          enum:
          - SUCCESS
          - FAILED
          - WARNING
          - REVOKED
          - NOT_CHECKED
          - INVALID
          - EXPIRING
          - EXPIRED
        message:
          type: string
      description: Certificate validation result
    ClientDto:
      required:
      - certificate
      - description
      - enabled
      - id
      - name
      - serialNumber
      - uuid
      type: object
      properties:
        id:
          type: integer
          description: Id of the client
          format: int64
        uuid:
          type: string
          description: UUID of the client
        serialNumber:
          type: string
          description: Client serial Number
        name:
          type: string
          description: Name of the client
        certificate:
          $ref: '#/components/schemas/CertificateDto'
        description:
          type: string
          description: Client description
        enabled:
          type: boolean
          description: Status of the client / Is Client enabled?
    RaProfileDto:
      required:
      - attributes
      - authorityInstanceName
      - authorityInstanceUuid
      - enabled
      - name
      - uuid
      type: object
      properties:
        uuid:
          type: string
          description: Object identifier
        name:
          type: string
          description: Object Name
        description:
          type: string
          description: Description of RA Profile
        authorityInstanceUuid:
          type: string
          description: UUID of Authority provider
        authorityInstanceName:
          type: string
          description: Name of Authority instance
        attributes:
          type: array
          description: List of RA Profiles attributes
          items:
            $ref: '#/components/schemas/AttributeDefinition'
        enabled:
          type: boolean
          description: Enabled flag - true = enabled; false = disabled
      description: RA Profile associated to the Certificate
    AddClientRequestDto:
      required:
      - certificateUuid
      - clientCertificate
      - description
      - enabled
      - name
      type: object
      properties:
        clientCertificate:
          type: string
          description: Base64 content of the client certificate
        certificateUuid:
          type: string
          description: UUID of the existing certificate in the Inventory
        name:
          type: string
          description: Name of the client
        description:
          type: string
          description: Description of the Client
        enabled:
          type: boolean
          description: Is the client enabled?
